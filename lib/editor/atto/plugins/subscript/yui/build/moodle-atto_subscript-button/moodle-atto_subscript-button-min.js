YUI.add("moodle-atto_subscript-button",function(e,t){e.namespace("M.atto_subscript").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_subscriptApplier:null,_superscriptApplier:null,initializer:function(){this.addButton({buttonName:"subscript",callback:this.toggleSubscript,icon:"e/subscript",tags:"sub"}),this._subscriptApplier=window.rangy.createCssClassApplier("editor-subscript"),this._superscriptApplier=window.rangy.createCssClassApplier("editor-superscript")},toggleSubscript:function(){var t=window.rangy.getSelection();if(t.isCollapsed){var n=e.one(this.get("host").getSelectionParentNode());document.execCommand("subscript",!1,null),n.ancestor("sub, sup")&&this.get("host").editor.once("keypress",function(){if(!n.compareTo(this.get("host").getSelectionParentNode()))return;e.soon(e.bind(function(){var n=e.one(this.get("host").getSelectionParentNode()).ancestor("sub",!0);if(!n)return;n.addClass("editor-subscript-new"),t=window.rangy.saveSelection(),this.changeToCSS(),this.get("host").setSelection(this.get("host").getSelectionFromNode(this.editor.one(".editor-subscript-new"))),this.editor.one(".editor-subscript-new").removeClass("editor-subscript-new"),this._subscriptApplier.undoToSelection(),this._superscriptApplier.undoToSelection(),this.changeToTags(),window.rangy.restoreSelection(t)},this))},this);return}this.changeToCSS(),this._superscriptApplier.undoToSelection(),this._subscriptApplier.toggleSelection(),this.changeToTags()},replaceTags:function(t,n){t.setAttribute("data-iterate",!0);var r=this.editor.one('[data-iterate="true"]');while(r){var i=e.Node.create("<"+n+" />").setAttrs(r.getAttrs()).removeAttribute("data-iterate");r.getAttribute("style")&&i.setAttribute("style",r.getAttribute("style")),r.getAttribute("class")&&i.setAttribute("class",r.getAttribute("class"));var s=r.getDOMNode().childNodes,o;o=s[0];while(typeof o!="undefined")i.append(o),o=s[0];r.replace(i),r=this.editor.one('[data-iterate="true"]')}},changeToCSS:function(){var e=window.rangy.saveSelection();this.editor.all("sub").addClass("editor-subscript"),this.editor.all("sup").addClass("editor-superscript"),this.replaceTags(this.editor.all(".editor-superscript, .editor-subscript"),"span"),window.rangy.restoreSelection(e)},changeToTags:function(){var e=window.rangy.saveSelection();this.replaceTags(this.editor.all(".editor-superscript"),"sup"),this.replaceTags(this.editor.all(".editor-subscript"),"sub"),this.editor.all('[class="editor-subscript"], [class="editor-superscript"]').removeAttribute("class"),this.editor.all("sub").removeClass("editor-subscript"),this.editor.all("sup").removeClass("editor-superscript"),window.rangy.restoreSelection(e)}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
